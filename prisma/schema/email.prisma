model Email {
  id               String           @id @default(cuid())
  senderEmail      String
  receiverEmail    String?
  subject          String?
  body             String
  attachment       String[]
  isReadBySender   Boolean          @default(true)
  isReadByReceiver Boolean          @default(false)
  isDraft          Boolean          @default(false)
  isSent           Boolean          @default(false)
  createdAt        DateTime         @default(now())
  senderId         String
  receiverId       String?
  parentEmailId    String?
  threadId         String?
  isReply          Boolean          @default(false)
  isArchived       Boolean          @default(false)
  isSpam           Boolean          @default(false)
  isStarred        Boolean          @default(false)
  isDeleted        Boolean          @default(false)
  parentEmail      Email?           @relation("EmailReplies", fields: [parentEmailId], references: [id])
  replies          Email[]          @relation("EmailReplies")
  receiver         users?           @relation("ReceivedEmails", fields: [receiverId], references: [id])
  sender           users            @relation("SentEmails", fields: [senderId], references: [id])
  states           UserEmailState[]

  @@index([createdAt])
  @@index([isArchived, receiverId, createdAt])
  @@index([isArchived, senderId, createdAt])
  @@index([isDraft, senderId])
  @@index([isReadByReceiver, receiverId, createdAt])
  @@index([isSent, senderId])
  @@index([isSpam, receiverId, createdAt])
  @@index([isStarred, receiverId, createdAt])
  @@index([isStarred, senderId, createdAt])
  @@index([parentEmailId])
  @@index([receiverEmail])
  @@index([receiverId, createdAt])
  @@index([receiverId, isDeleted, createdAt])
  @@index([receiverId, isDeleted, isSpam, isArchived, createdAt])
  @@index([senderEmail])
  @@index([senderId, createdAt])
  @@index([senderId, isDeleted, createdAt])
  @@index([senderId, isDeleted, isDraft, isSent, createdAt])
  @@index([threadId, createdAt, id])
  @@index([threadId, createdAt])
}

model UserEmailState {
  id         String  @id @default(cuid())
  emailId    String
  userId     String
  isRead     Boolean @default(false)
  isStarred  Boolean @default(false)
  isArchived Boolean @default(false)
  isSpam     Boolean @default(false)
  isDeleted  Boolean @default(false)
  isDraft    Boolean @default(false)
  email      Email   @relation(fields: [emailId], references: [id])
  user       users   @relation(fields: [userId], references: [id])

  @@unique([emailId, userId])
  @@index([emailId])
  @@index([userId, isArchived, isDeleted])
  @@index([userId, isDeleted])
  @@index([userId, isDraft])
  @@index([userId, isRead, isArchived, isSpam, isDeleted])
  @@index([userId, isRead, isDeleted])
  @@index([userId, isSpam, isDeleted])
  @@index([userId, isStarred, isDeleted])
  @@index([userId, isStarred, isRead, isDeleted])
}

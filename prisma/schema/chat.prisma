model Message {
  id         String    @id @default(cuid())
  content    String?
  senderId   String
  receiverId String
  createdAt  DateTime  @default(now())
  chatRoomId String
  images     String[]
  audios     String[]
  files      String[]
  videos     String[]
  chatType   chatType?
  chatRoom   ChatRoom  @relation(fields: [chatRoomId], references: [id])
  receiver   users     @relation("messagesReceived", fields: [receiverId], references: [id])
  sender     users     @relation("messagesSent", fields: [senderId], references: [id])

  @@index([chatRoomId, createdAt, id])
  @@index([chatRoomId, createdAt])
  @@index([chatRoomId, senderId, createdAt])
  @@index([chatType, createdAt])
  @@index([createdAt])
  @@index([receiverId, createdAt])
  @@index([senderId, createdAt])
}

model ChatRoom {
  id            String       @id @default(cuid())
  user1Id       String
  user2Id       String
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  maintenanceId String?      @unique
  user1         users        @relation("chatRoomsUser1", fields: [user1Id], references: [id])
  user2         users        @relation("chatRoomsUser2", fields: [user2Id], references: [id])
  messages      Message[]
  maintenance   maintenance?

  @@unique([user1Id, user2Id])
  @@index([createdAt])
  @@index([maintenanceId])
  @@index([updatedAt])
  @@index([user1Id, updatedAt, id])
  @@index([user1Id, updatedAt])
  @@index([user1Id, user2Id, updatedAt])
  @@index([user2Id, updatedAt, id])
  @@index([user2Id, updatedAt])
}

enum chatType {
  MAINTENANCE
  APPLICATION
  SUPPORT
}

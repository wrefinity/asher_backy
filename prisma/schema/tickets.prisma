model SupportTicket {
  id               String          @id @default(cuid())
  ticketCode       String          @unique // Human-readable ticket code (e.g., LJA-2311251200)
  raisedById       String?
  assignedToId     String?
  type             TicketType      @default(SUPPORT)
  subject          String
  description      String
  priority         TicketPriority  @default(PENDING)
  status           TicketStatus    @default(OPEN)
  attachments      String[]
  createdAt        DateTime        @default(now())
  updatedAt        DateTime        @updatedAt
  raisedByTenantId String?
  assignedTo       users?          @relation("TicketAssignedTo", fields: [assignedToId], references: [id])
  raisedBy         landlords?      @relation("TicketRaisedBy", fields: [raisedById], references: [id])
  raisedByTenant   tenants?        @relation("TicketTenantRaisedBy", fields: [raisedByTenantId], references: [id])
  messages         TicketMessage[]

  @@index([raisedById])
  @@index([assignedToId])
  @@index([ticketCode])
}

model TicketMessage {
  id          String        @id @default(cuid())
  ticketId    String
  ticket      SupportTicket @relation(fields: [ticketId], references: [id], onDelete: Cascade)
  senderId    String
  sender      users         @relation(fields: [senderId], references: [id])
  content     String
  attachments String[]
  isInternal  Boolean       @default(false) // Internal notes visible only to admin
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  @@index([ticketId])
  @@index([senderId])
}

enum TicketStatus {
  OPEN
  IN_PROGRESS
  RESOLVED
  CLOSED
}

enum TicketType {
  SUPPORT
  SUGGESTION
}

enum TicketPriority {
  HIGH
  MEDIUM
  LOW
  PENDING
}
